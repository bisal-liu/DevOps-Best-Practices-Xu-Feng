# 7. 监控
## 7.1 引言
本文描述了应用和基础设施架构如何影响DevOps监控工具的选择和使用。
## 7.2 术语
**监控层模型**

有成千上万的监控工具，从中可以选择用于部署流水线和生产的监控。**事件黑名单**
应被监控工具触发通知的事件被列在了黑名单中，这意味着当这些事件发生时，将会触发告警，运维团队随后便能采取相应措施。**事件白名单**
不会触发告警的事件会被放在白名单中。**误报**
应用引发一个导致异常的错误，而事实上没有错误发生。**漏报**
应用没有在事件中提示错误，而实际上错误的情况已经发生。
##7.3 概念
监测层模型
有成千上万的监控工具，从中可以选择用于部署流水线和生产的监控。
图7-1 给出了可用于监控一个服务的各种监控功能综述。
![img](./pics/Chapter_7_cn/clip_image002.png)图7-1， 监测层模型[BEST 2015b]
F1. 系统监测（单元监控）系统监控是监控层模型的基础，用于度量所有应用和基础设施单元。系统监控由于其单元层级的特性而有别于其它监控形式，因此系统监控也被称作单元监控。只有个别应用和基础设施组件不需要通过它来度量。对于基础设施的技术管理，系统监控是必不可少的。系统监控由以下监控功能组成。| F1.1    | 服务监控 | 基础设施服务和应用服务的监控。这些服务通过一种管理协议来度量，通常使用简单网络管理协议（SNMP）。 | 
| ------ | ------ | ------ |
| F1.2 | 资源监控 |   监控资源表现形式上的某一单独组件，比如CPU，内存和网络带宽。   |
|F1.3 |   内建监控   |   内建监控是一种作为应用组成部分的监控设施，它的价值在于可以度量应用运行计数器，而这在应用之外是不可见的。    |  
| F1.4 |   事件监控     |    事件监控包含了所有的基础设施组件和基础设施服务，以及应用事件。事件通常通过读取本地日志文件来获取，比如应用日志、安全日志和错误日志文件。    |    

表7-1，系统监控

F2. 应用监控通过度量底层系统（系统监控）、基础设施服务和应用接口，应用监控为一个独立应用（子系统）或服务提供镜像信息。这一层对于应用管理而言很重要，它在一个视图中显示出了来自一个应用的所有相关信息。应用监控包含系统监控功能的同时，还具备如下监控功能。| F2.1    | 应用接口监控 | 应用接口监控是特别为应用管理员们准备的，这样他们可以一目了然的确定应用正在按照预期运行。因此，很有必要的是，每个应用都需要明确哪些基础设施组件、基础设施服务和应用服务是重要的。另外，用于验证基础设施和应用代码之间交互的度量会在应用层。 | 
| --------- | ------------------- | ------------------------------- |
| F2.2 | 基础设施服务监控 |   虽然可能一个基础设施服务是“活的”，但并不意味着它在正常工作或者可访问。为了确定服务是否正常工作，需要在服务被调用的基础设施层运行动态测试。   |

表7-2，应用监控

F3:信息系统监控实现一个用户功能，需要多个应用。但这些经常不会被用户单独识别到。为了在这层制定用户协议，除了应用监控层外，我们也定义了信息系统监测层，本质上它是一系列的应用。度量一个端到端（E2E）信息系统，应尽可能从用户层面来开展监控，这些度量通常通过遍历业务路径来实现，因此这一级的监控又被称作业务监控。E2E基础设施度量也被实现为支撑这一度量，E2E基础设施监控展示了基础设施各种组件间是否存在关联，在地理位置分离和具有更多逻辑网络（局域网（LAN）、广域网（WAN）等等）的大型计算中心尤其如此。信息系统监控在以下功能上作为应用监控的补充：
| F3.1    | 信息系统E2E监控 | 一个应用可用并不意味着用户可以正常使用，通常多个应用结合在一起才能完成整个链路（信息系统）。 | 
| --------- | ----------- | ------ |
| F3.2 | 基础设施E2E监控 |   E2E监控基础设施包含整个基础设施层的度量，这种监控通常应用于广域网（WAN）。   |
|F3.3 |  基础设施域监测   |   在具有多个供应商或网络被分割成单独的物理／逻辑域情况下，从可用性等考虑，需要单独监控这些域。这些域可能有其它的标准如相对于办公自动化网络的隔离区（DMZ）域。   |  

表7-3，信息系统监控

F4 链路监控
